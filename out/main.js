// Copyright Charles Dueck 2020
import { Viewport, PanGesture, PinchZoomGesture } from "./viewport.js";
import { TouchDemux } from "./touch.js";
import { Gestures } from "./gesture.js";
import { sceneMethod, sceneRenderer } from "./scene.js";
const c = document.getElementById("canvas");
if (c === null) {
    throw new Error("No canvas element");
}
const ctx = c.getContext("2d");
if (ctx === null) {
    throw new Error("No 2d context");
}
/*
//     0 - 1 - 2
//   / | \ | / | \
// 6 - 3 - 4 - 5 - 7

const scene: Scene = {
    truss: {
        pins: [
            [35.0, 35.0],
            [40.0, 35.0],
            [45.0, 35.0],
            [35.0, 30.0],
            [40.0, 30.0],
            [45.0, 30.0],
            [30.0, 30.0],
            [50.0, 30.0],
        ],
        mobilePins: 8,
        beams: [
            { p1: 0, p2: 1, m: 0, w: 0.1 },
            { p1: 1, p2: 2, m: 0, w: 0.1 },
            { p1: 6, p2: 0, m: 0, w: 0.1 },
            { p1: 3, p2: 0, m: 0, w: 0.1 },
            { p1: 4, p2: 0, m: 0, w: 0.1 },
            { p1: 4, p2: 1, m: 0, w: 0.1 },
            { p1: 4, p2: 2, m: 0, w: 0.1 },
            { p1: 5, p2: 2, m: 0, w: 0.1 },
            { p1: 7, p2: 2, m: 0, w: 0.1 },
            { p1: 6, p2: 3, m: 0, w: 0.1, deck: true },
            { p1: 3, p2: 4, m: 0, w: 0.1, deck: true },
            { p1: 4, p2: 5, m: 0, w: 0.1, deck: true },
            { p1: 5, p2: 7, m: 0, w: 0.1, deck: true },
        ],
        discs: [
        ],
        materials: [
            {   // Rubber.
                E: 20000000.0,
                style: "black",
                density: 1200.0,
                friction: 0.9,
            },
        ],
    },
    terrain: {
        hmap: [
            40.0,
            16.0,
            14.0,
            12.0,
            10.0,
            8.0,
            6.0,
            5.0,
            4.0,
            4.0,
            40.0,
        ],
        style: "darkgrey",
        pitch: 10.0,
        friction: 0.5,
    },
    height: 100.0,
    g: [0.0, -9.8],
};
*/
/*
//             0
//
// 6 - 1 - 2 - 3 - 4 - 5 - 7
const w = 1;
const scene: Scene = {
    truss: {
        pins: [
            [40.0, 40.0],
            [25.0, 27.5],
            [30.0, 25.0],
            [35.0, 22.5],
            [40.0, 20.0],
            [45.0, 22.5],
            [50.0, 25.0],
            [55.0, 27.5],
            [20.0, 30.0],
            [60.0, 30.0],
        ],
        mobilePins: 8,
        beams: [
            { p1: 8, p2: 1, m: 0, w: w, deck: true },
            { p1: 1, p2: 2, m: 0, w: w, deck: true },
            { p1: 2, p2: 3, m: 0, w: w, deck: true },
            { p1: 3, p2: 4, m: 0, w: w, deck: true },
            { p1: 4, p2: 5, m: 0, w: w, deck: true },
            { p1: 5, p2: 6, m: 0, w: w, deck: true },
            { p1: 6, p2: 7, m: 0, w: w, deck: true },
            { p1: 7, p2: 9, m: 0, w: w, deck: true },
        ],
        discs: [
            { p: 0, r: 2.5, m: 0 },
        ],
        materials: [
            {   // Rubber.
                E: 20000000.0,
                style: "black",
                density: 1200.0,
                friction: 0.9,
            },
        ],
    },
    terrain: {
        hmap: [
            40.0,
            16.0,
            14.0,
            12.0,
            10.0,
            8.0,
            6.0,
            5.0,
            4.0,
            4.0,
            40.0,
        ],
        style: "darkgrey",
        pitch: 10.0,
        friction: 0.5,
    },
    height: 100.0,
    g: [0.0, -9.8],
};
*/
//     8 - 9 - 10
//   / | \ | / | \
// 14- 11- 12- 13- 15
const scene = {
    truss: {
        pins: [
            [5.0, 42.5],
            [10.0, 42.5],
            [15.0, 42.5],
            [20.0, 42.5],
            [25.0, 42.5],
            [10.0, 40.0],
            [15.0, 40.0],
            [20.0, 40.0],
            [40.0, 50.0],
            [50.0, 50.0],
            [60.0, 50.0],
            [40.0, 40.0],
            [50.0, 40.0],
            [60.0, 40.0],
            [30.0, 40.0],
            [70.0, 40.0],
            [0.0, 40.0],
            [100.0, 40.0],
        ],
        mobilePins: 14,
        beams: [
            { p1: 0, p2: 1, m: 0, w: 0.1 },
            { p1: 1, p2: 2, m: 0, w: 0.1 },
            { p1: 2, p2: 3, m: 0, w: 0.1 },
            { p1: 3, p2: 4, m: 0, w: 0.1 },
            { p1: 1, p2: 5, m: 0, w: 0.1 },
            { p1: 2, p2: 6, m: 0, w: 0.1 },
            { p1: 3, p2: 7, m: 0, w: 0.1 },
            { p1: 0, p2: 5, m: 0, w: 0.1 },
            { p1: 5, p2: 2, m: 0, w: 0.1 },
            { p1: 1, p2: 6, m: 0, w: 0.1 },
            { p1: 6, p2: 3, m: 0, w: 0.1 },
            { p1: 2, p2: 7, m: 0, w: 0.1 },
            { p1: 7, p2: 4, m: 0, w: 0.1 },
            { p1: 8, p2: 14, m: 0, w: 1.0 },
            { p1: 8, p2: 11, m: 0, w: 1.0 },
            { p1: 8, p2: 12, m: 0, w: 1.0 },
            { p1: 8, p2: 9, m: 0, w: 1.0 },
            { p1: 9, p2: 12, m: 0, w: 1.0 },
            { p1: 10, p2: 9, m: 0, w: 1.0 },
            { p1: 10, p2: 12, m: 0, w: 1.0 },
            { p1: 10, p2: 13, m: 0, w: 1.0 },
            { p1: 10, p2: 15, m: 0, w: 1.0 },
            { p1: 14, p2: 11, m: 0, w: 1.0, deck: true },
            { p1: 11, p2: 12, m: 0, w: 1.0, deck: true },
            { p1: 12, p2: 13, m: 0, w: 1.0, deck: true },
            { p1: 13, p2: 15, m: 0, w: 1.0, deck: true },
            { p1: 16, p2: 14, m: 0, w: 0.1, deck: true },
            { p1: 15, p2: 17, m: 0, w: 0.1, deck: true },
        ],
        discs: [
            { p: 0, r: 2.5, m: 0, v: 10.0 },
            { p: 1, r: 2.5, m: 0, v: 10.0 },
            { p: 2, r: 2.5, m: 0, v: 10.0 },
            { p: 3, r: 2.5, m: 0, v: 10.0 },
            { p: 4, r: 2.5, m: 0, v: 10.0 },
        ],
        materials: [
            {
                E: 70000000.0,
                style: "black",
                density: 1200.0,
                friction: 0.9,
            },
        ],
    },
    terrain: {
        hmap: [
            40.0,
            40.0,
            40.0,
            40.0,
            40.0,
            40.0,
            40.0,
            20.0,
            20.0,
            20.0,
            20.0,
            20.0,
            20.0,
            20.0,
            40.0,
            40.0,
            40.0,
            40.0,
            40.0,
            40.0,
            40.0,
        ],
        style: "darkgrey",
        pitch: 5.0,
        friction: 0.5,
    },
    height: 100.0,
    g: [0.0, -9.8],
};
const ode = sceneMethod(scene);
const render = sceneRenderer(scene);
const vp = new Viewport(ctx, (_b, _s, ctx) => {
    render(ctx, ode);
});
function clip(v, min, max) {
    return Math.min(max, Math.max(min, v));
}
vp.setClipPosition((p) => {
    p.scale = clip(p.scale, 10.0, 1000.0);
    p.pos[0] = clip(p.pos[0], 0, scene.terrain.pitch * (scene.terrain.hmap.length - 1));
    p.pos[1] = clip(p.pos[1], 0, scene.height);
    p.rotate = 0.0;
    return p;
});
vp.setPosition({ pos: [50, 50] });
const h = 0.001;
requestAnimationFrame((t0) => {
    function mainLoop(t) {
        // Compute up to 250ms worth of frames at a time.
        const dt = Math.min(t - t0, 250.0);
        const frames = Math.floor(dt / (1000.0 * h));
        for (let i = 0; i < frames; i++) {
            ode.next(h);
        }
        vp.requestRedraw();
        // Only let the physics backlog get to 250ms.
        t0 = Math.max(t0 + frames * h * 1000.0, t - 250.0);
        requestAnimationFrame(mainLoop);
    }
    requestAnimationFrame(mainLoop);
});
window.addEventListener("resize", vp.resize);
const touch = new TouchDemux(c);
const gesture = new Gestures();
touch.addTouchHandler(gesture);
gesture.addGestureHandler(new PanGesture(vp));
gesture.addGestureHandler(new PinchZoomGesture(vp));
// TODO: mouse and trackpad input
// scroll
// scroll wheel zoom in and out
// what to rotate? right click drag, rotate around center of vp? Maybe don't care, since bridge wont use rotate
// TODO: https://developer.mozilla.org/en-US/docs/Web/API/Element/requestFullscreen
// https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API/Guide
// Look into this
// TODO: rewrite viewport etc. to not take callbacks, just call into it to explcitly set up canvas, etc.
// TODO: Physics calculation in a web-worker.
// TODO: Air resistance, or at least damping of pin movement, not just beam spring forces. Keep beam damping, this should be independent.
// TODO: Beams fail after some stress.
// TODO: Work hardening.
// TODO: Beam buckling.
console.log("stuff loaded");
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLCtCQUErQjtBQUUvQixPQUFPLEVBQUUsUUFBUSxFQUFvQixVQUFVLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxlQUFlLENBQUE7QUFDeEYsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLFlBQVksQ0FBQTtBQUN2QyxPQUFPLEVBQUUsUUFBUSxFQUFDLE1BQU0sY0FBYyxDQUFBO0FBQ3RDLE9BQU8sRUFBRSxXQUFXLEVBQUUsYUFBYSxFQUFTLE1BQU0sWUFBWSxDQUFDO0FBRS9ELE1BQU0sQ0FBQyxHQUFJLFFBQVEsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUF1QixDQUFDO0FBQ25FLElBQUksQ0FBQyxLQUFLLElBQUksRUFBRTtJQUNaLE1BQU0sSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQztDQUN4QztBQUNELE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDL0IsSUFBSSxHQUFHLEtBQUssSUFBSSxFQUFFO0lBQ2QsTUFBTSxJQUFJLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQztDQUNwQztBQUNEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztFQWlFRTtBQUNGOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7RUErREU7QUFFRixpQkFBaUI7QUFDakIsa0JBQWtCO0FBQ2xCLHFCQUFxQjtBQUVyQixNQUFNLEtBQUssR0FBVTtJQUNqQixLQUFLLEVBQUU7UUFDSCxJQUFJLEVBQUU7WUFDRixDQUFFLEdBQUcsRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDWixDQUFFLEdBQUcsRUFBRSxJQUFJLENBQUM7WUFDWixDQUFDLEtBQUssRUFBRSxJQUFJLENBQUM7U0FDaEI7UUFDRCxVQUFVLEVBQUUsRUFBRTtRQUNkLEtBQUssRUFBRTtZQUNILEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRTtZQUM5QixFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUU7WUFDOUIsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFO1lBQzlCLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRTtZQUM5QixFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUU7WUFDOUIsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFO1lBQzlCLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRTtZQUM5QixFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUU7WUFDOUIsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFO1lBQzlCLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRTtZQUM5QixFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUU7WUFDOUIsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFO1lBQzlCLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRTtZQUM5QixFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUU7WUFDL0IsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFO1lBQy9CLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRTtZQUMvQixFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUU7WUFDOUIsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFO1lBQy9CLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRTtZQUMvQixFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUU7WUFDaEMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFO1lBQ2hDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRTtZQUNoQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtZQUM1QyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtZQUM1QyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtZQUM1QyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtZQUM1QyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtZQUM1QyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtTQUMvQztRQUNELEtBQUssRUFBRTtZQUNILEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRTtZQUMvQixFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUU7WUFDL0IsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFO1lBQy9CLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRTtZQUMvQixFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFD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ZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCBDaGFybGVzIER1ZWNrIDIwMjBcblxuaW1wb3J0IHsgVmlld3BvcnQsIFZpZXdwb3J0UG9zaXRpb24sIFBhbkdlc3R1cmUsIFBpbmNoWm9vbUdlc3R1cmUgfSBmcm9tIFwiLi92aWV3cG9ydC5qc1wiXG5pbXBvcnQgeyBUb3VjaERlbXV4IH0gZnJvbSBcIi4vdG91Y2guanNcIlxuaW1wb3J0IHsgR2VzdHVyZXN9IGZyb20gXCIuL2dlc3R1cmUuanNcIlxuaW1wb3J0IHsgc2NlbmVNZXRob2QsIHNjZW5lUmVuZGVyZXIsIFNjZW5lIH0gZnJvbSBcIi4vc2NlbmUuanNcIjtcblxuY29uc3QgYyA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhbnZhc1wiKSBhcyBIVE1MQ2FudmFzRWxlbWVudCk7XG5pZiAoYyA9PT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk5vIGNhbnZhcyBlbGVtZW50XCIpO1xufVxuY29uc3QgY3R4ID0gYy5nZXRDb250ZXh0KFwiMmRcIik7XG5pZiAoY3R4ID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gMmQgY29udGV4dFwiKTtcbn1cbi8qXG4vLyAgICAgMCAtIDEgLSAyXG4vLyAgIC8gfCBcXCB8IC8gfCBcXFxuLy8gNiAtIDMgLSA0IC0gNSAtIDdcblxuY29uc3Qgc2NlbmU6IFNjZW5lID0ge1xuICAgIHRydXNzOiB7XG4gICAgICAgIHBpbnM6IFtcbiAgICAgICAgICAgIFszNS4wLCAzNS4wXSxcbiAgICAgICAgICAgIFs0MC4wLCAzNS4wXSxcbiAgICAgICAgICAgIFs0NS4wLCAzNS4wXSxcbiAgICAgICAgICAgIFszNS4wLCAzMC4wXSxcbiAgICAgICAgICAgIFs0MC4wLCAzMC4wXSxcbiAgICAgICAgICAgIFs0NS4wLCAzMC4wXSxcbiAgICAgICAgICAgIFszMC4wLCAzMC4wXSxcbiAgICAgICAgICAgIFs1MC4wLCAzMC4wXSxcbiAgICAgICAgXSxcbiAgICAgICAgbW9iaWxlUGluczogOCxcbiAgICAgICAgYmVhbXM6IFtcbiAgICAgICAgICAgIHsgcDE6IDAsIHAyOiAxLCBtOiAwLCB3OiAwLjEgfSxcbiAgICAgICAgICAgIHsgcDE6IDEsIHAyOiAyLCBtOiAwLCB3OiAwLjEgfSxcbiAgICAgICAgICAgIHsgcDE6IDYsIHAyOiAwLCBtOiAwLCB3OiAwLjEgfSxcbiAgICAgICAgICAgIHsgcDE6IDMsIHAyOiAwLCBtOiAwLCB3OiAwLjEgfSxcbiAgICAgICAgICAgIHsgcDE6IDQsIHAyOiAwLCBtOiAwLCB3OiAwLjEgfSxcbiAgICAgICAgICAgIHsgcDE6IDQsIHAyOiAxLCBtOiAwLCB3OiAwLjEgfSxcbiAgICAgICAgICAgIHsgcDE6IDQsIHAyOiAyLCBtOiAwLCB3OiAwLjEgfSxcbiAgICAgICAgICAgIHsgcDE6IDUsIHAyOiAyLCBtOiAwLCB3OiAwLjEgfSxcbiAgICAgICAgICAgIHsgcDE6IDcsIHAyOiAyLCBtOiAwLCB3OiAwLjEgfSxcbiAgICAgICAgICAgIHsgcDE6IDYsIHAyOiAzLCBtOiAwLCB3OiAwLjEsIGRlY2s6IHRydWUgfSxcbiAgICAgICAgICAgIHsgcDE6IDMsIHAyOiA0LCBtOiAwLCB3OiAwLjEsIGRlY2s6IHRydWUgfSxcbiAgICAgICAgICAgIHsgcDE6IDQsIHAyOiA1LCBtOiAwLCB3OiAwLjEsIGRlY2s6IHRydWUgfSxcbiAgICAgICAgICAgIHsgcDE6IDUsIHAyOiA3LCBtOiAwLCB3OiAwLjEsIGRlY2s6IHRydWUgfSxcbiAgICAgICAgXSxcbiAgICAgICAgZGlzY3M6IFtcbiAgICAgICAgXSxcbiAgICAgICAgbWF0ZXJpYWxzOiBbXG4gICAgICAgICAgICB7ICAgLy8gUnViYmVyLlxuICAgICAgICAgICAgICAgIEU6IDIwMDAwMDAwLjAsXG4gICAgICAgICAgICAgICAgc3R5bGU6IFwiYmxhY2tcIixcbiAgICAgICAgICAgICAgICBkZW5zaXR5OiAxMjAwLjAsXG4gICAgICAgICAgICAgICAgZnJpY3Rpb246IDAuOSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSxcbiAgICB0ZXJyYWluOiB7XG4gICAgICAgIGhtYXA6IFtcbiAgICAgICAgICAgIDQwLjAsXG4gICAgICAgICAgICAxNi4wLFxuICAgICAgICAgICAgMTQuMCxcbiAgICAgICAgICAgIDEyLjAsXG4gICAgICAgICAgICAxMC4wLFxuICAgICAgICAgICAgOC4wLFxuICAgICAgICAgICAgNi4wLFxuICAgICAgICAgICAgNS4wLFxuICAgICAgICAgICAgNC4wLFxuICAgICAgICAgICAgNC4wLFxuICAgICAgICAgICAgNDAuMCxcbiAgICAgICAgXSxcbiAgICAgICAgc3R5bGU6IFwiZGFya2dyZXlcIixcbiAgICAgICAgcGl0Y2g6IDEwLjAsXG4gICAgICAgIGZyaWN0aW9uOiAwLjUsXG4gICAgfSxcbiAgICBoZWlnaHQ6IDEwMC4wLFxuICAgIGc6IFswLjAsIC05LjhdLFxufTtcbiovXG4vKlxuLy8gICAgICAgICAgICAgMFxuLy9cbi8vIDYgLSAxIC0gMiAtIDMgLSA0IC0gNSAtIDdcbmNvbnN0IHcgPSAxO1xuY29uc3Qgc2NlbmU6IFNjZW5lID0ge1xuICAgIHRydXNzOiB7XG4gICAgICAgIHBpbnM6IFtcbiAgICAgICAgICAgIFs0MC4wLCA0MC4wXSxcbiAgICAgICAgICAgIFsyNS4wLCAyNy41XSxcbiAgICAgICAgICAgIFszMC4wLCAyNS4wXSxcbiAgICAgICAgICAgIFszNS4wLCAyMi41XSxcbiAgICAgICAgICAgIFs0MC4wLCAyMC4wXSxcbiAgICAgICAgICAgIFs0NS4wLCAyMi41XSxcbiAgICAgICAgICAgIFs1MC4wLCAyNS4wXSxcbiAgICAgICAgICAgIFs1NS4wLCAyNy41XSxcbiAgICAgICAgICAgIFsyMC4wLCAzMC4wXSxcbiAgICAgICAgICAgIFs2MC4wLCAzMC4wXSxcbiAgICAgICAgXSxcbiAgICAgICAgbW9iaWxlUGluczogOCxcbiAgICAgICAgYmVhbXM6IFtcbiAgICAgICAgICAgIHsgcDE6IDgsIHAyOiAxLCBtOiAwLCB3OiB3LCBkZWNrOiB0cnVlIH0sXG4gICAgICAgICAgICB7IHAxOiAxLCBwMjogMiwgbTogMCwgdzogdywgZGVjazogdHJ1ZSB9LFxuICAgICAgICAgICAgeyBwMTogMiwgcDI6IDMsIG06IDAsIHc6IHcsIGRlY2s6IHRydWUgfSxcbiAgICAgICAgICAgIHsgcDE6IDMsIHAyOiA0LCBtOiAwLCB3OiB3LCBkZWNrOiB0cnVlIH0sXG4gICAgICAgICAgICB7IHAxOiA0LCBwMjogNSwgbTogMCwgdzogdywgZGVjazogdHJ1ZSB9LFxuICAgICAgICAgICAgeyBwMTogNSwgcDI6IDYsIG06IDAsIHc6IHcsIGRlY2s6IHRydWUgfSxcbiAgICAgICAgICAgIHsgcDE6IDYsIHAyOiA3LCBtOiAwLCB3OiB3LCBkZWNrOiB0cnVlIH0sXG4gICAgICAgICAgICB7IHAxOiA3LCBwMjogOSwgbTogMCwgdzogdywgZGVjazogdHJ1ZSB9LFxuICAgICAgICBdLFxuICAgICAgICBkaXNjczogW1xuICAgICAgICAgICAgeyBwOiAwLCByOiAyLjUsIG06IDAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgbWF0ZXJpYWxzOiBbXG4gICAgICAgICAgICB7ICAgLy8gUnViYmVyLlxuICAgICAgICAgICAgICAgIEU6IDIwMDAwMDAwLjAsXG4gICAgICAgICAgICAgICAgc3R5bGU6IFwiYmxhY2tcIixcbiAgICAgICAgICAgICAgICBkZW5zaXR5OiAxMjAwLjAsXG4gICAgICAgICAgICAgICAgZnJpY3Rpb246IDAuOSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSxcbiAgICB0ZXJyYWluOiB7XG4gICAgICAgIGhtYXA6IFtcbiAgICAgICAgICAgIDQwLjAsXG4gICAgICAgICAgICAxNi4wLFxuICAgICAgICAgICAgMTQuMCxcbiAgICAgICAgICAgIDEyLjAsXG4gICAgICAgICAgICAxMC4wLFxuICAgICAgICAgICAgOC4wLFxuICAgICAgICAgICAgNi4wLFxuICAgICAgICAgICAgNS4wLFxuICAgICAgICAgICAgNC4wLFxuICAgICAgICAgICAgNC4wLFxuICAgICAgICAgICAgNDAuMCxcbiAgICAgICAgXSxcbiAgICAgICAgc3R5bGU6IFwiZGFya2dyZXlcIixcbiAgICAgICAgcGl0Y2g6IDEwLjAsXG4gICAgICAgIGZyaWN0aW9uOiAwLjUsXG4gICAgfSxcbiAgICBoZWlnaHQ6IDEwMC4wLFxuICAgIGc6IFswLjAsIC05LjhdLFxufTtcbiovXG5cbi8vICAgICA4IC0gOSAtIDEwXG4vLyAgIC8gfCBcXCB8IC8gfCBcXFxuLy8gMTQtIDExLSAxMi0gMTMtIDE1XG5cbmNvbnN0IHNjZW5lOiBTY2VuZSA9IHtcbiAgICB0cnVzczoge1xuICAgICAgICBwaW5zOiBbXG4gICAgICAgICAgICBbIDUuMCwgNDIuNV0sICAgIC8vIDAtNyBUcmFpblxuICAgICAgICAgICAgWzEwLjAsIDQyLjVdLFxuICAgICAgICAgICAgWzE1LjAsIDQyLjVdLFxuICAgICAgICAgICAgWzIwLjAsIDQyLjVdLFxuICAgICAgICAgICAgWzI1LjAsIDQyLjVdLFxuICAgICAgICAgICAgWzEwLjAsIDQwLjBdLFxuICAgICAgICAgICAgWzE1LjAsIDQwLjBdLFxuICAgICAgICAgICAgWzIwLjAsIDQwLjBdLFxuICAgICAgICAgICAgWzQwLjAsIDUwLjBdLCAgIC8vIDgtMTUgQnJpZGdlXG4gICAgICAgICAgICBbNTAuMCwgNTAuMF0sXG4gICAgICAgICAgICBbNjAuMCwgNTAuMF0sXG4gICAgICAgICAgICBbNDAuMCwgNDAuMF0sXG4gICAgICAgICAgICBbNTAuMCwgNDAuMF0sXG4gICAgICAgICAgICBbNjAuMCwgNDAuMF0sXG4gICAgICAgICAgICBbMzAuMCwgNDAuMF0sICAgLy8gMTQgQnJpZGdlIGFuY2hvclxuICAgICAgICAgICAgWzcwLjAsIDQwLjBdLFxuICAgICAgICAgICAgWyAwLjAsIDQwLjBdLCAgIC8vIHJvYWRcbiAgICAgICAgICAgIFsxMDAuMCwgNDAuMF0sXG4gICAgICAgIF0sXG4gICAgICAgIG1vYmlsZVBpbnM6IDE0LFxuICAgICAgICBiZWFtczogW1xuICAgICAgICAgICAgeyBwMTogMCwgcDI6IDEsIG06IDAsIHc6IDAuMSB9LCAvLyBUcmFpblxuICAgICAgICAgICAgeyBwMTogMSwgcDI6IDIsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogMiwgcDI6IDMsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogMywgcDI6IDQsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogMSwgcDI6IDUsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogMiwgcDI6IDYsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogMywgcDI6IDcsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogMCwgcDI6IDUsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogNSwgcDI6IDIsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogMSwgcDI6IDYsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogNiwgcDI6IDMsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogMiwgcDI6IDcsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogNywgcDI6IDQsIG06IDAsIHc6IDAuMSB9LFxuICAgICAgICAgICAgeyBwMTogOCwgcDI6IDE0LCBtOiAwLCB3OiAxLjAgfSwgLy8gQnJpZGdlXG4gICAgICAgICAgICB7IHAxOiA4LCBwMjogMTEsIG06IDAsIHc6IDEuMCB9LFxuICAgICAgICAgICAgeyBwMTogOCwgcDI6IDEyLCBtOiAwLCB3OiAxLjAgfSxcbiAgICAgICAgICAgIHsgcDE6IDgsIHAyOiA5LCBtOiAwLCB3OiAxLjAgfSxcbiAgICAgICAgICAgIHsgcDE6IDksIHAyOiAxMiwgbTogMCwgdzogMS4wIH0sXG4gICAgICAgICAgICB7IHAxOiAxMCwgcDI6IDksIG06IDAsIHc6IDEuMCB9LFxuICAgICAgICAgICAgeyBwMTogMTAsIHAyOiAxMiwgbTogMCwgdzogMS4wIH0sXG4gICAgICAgICAgICB7IHAxOiAxMCwgcDI6IDEzLCBtOiAwLCB3OiAxLjAgfSxcbiAgICAgICAgICAgIHsgcDE6IDEwLCBwMjogMTUsIG06IDAsIHc6IDEuMCB9LFxuICAgICAgICAgICAgeyBwMTogMTQsIHAyOiAxMSwgbTogMCwgdzogMS4wLCBkZWNrOiB0cnVlIH0sICAgLy8gRGVja1xuICAgICAgICAgICAgeyBwMTogMTEsIHAyOiAxMiwgbTogMCwgdzogMS4wLCBkZWNrOiB0cnVlIH0sXG4gICAgICAgICAgICB7IHAxOiAxMiwgcDI6IDEzLCBtOiAwLCB3OiAxLjAsIGRlY2s6IHRydWUgfSxcbiAgICAgICAgICAgIHsgcDE6IDEzLCBwMjogMTUsIG06IDAsIHc6IDEuMCwgZGVjazogdHJ1ZSB9LFxuICAgICAgICAgICAgeyBwMTogMTYsIHAyOiAxNCwgbTogMCwgdzogMC4xLCBkZWNrOiB0cnVlIH0sICAgLy8gUm9hZFxuICAgICAgICAgICAgeyBwMTogMTUsIHAyOiAxNywgbTogMCwgdzogMC4xLCBkZWNrOiB0cnVlIH0sXG4gICAgICAgIF0sXG4gICAgICAgIGRpc2NzOiBbXG4gICAgICAgICAgICB7IHA6IDAsIHI6IDIuNSwgbTogMCwgdjogMTAuMCB9LFxuICAgICAgICAgICAgeyBwOiAxLCByOiAyLjUsIG06IDAsIHY6IDEwLjAgfSxcbiAgICAgICAgICAgIHsgcDogMiwgcjogMi41LCBtOiAwLCB2OiAxMC4wIH0sXG4gICAgICAgICAgICB7IHA6IDMsIHI6IDIuNSwgbTogMCwgdjogMTAuMCB9LFxuICAgICAgICAgICAgeyBwOiA0LCByOiAyLjUsIG06IDAsIHY6IDEwLjAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgbWF0ZXJpYWxzOiBbXG4gICAgICAgICAgICB7ICAgLy8gUnViYmVyLlxuICAgICAgICAgICAgICAgIEU6IDcwMDAwMDAwLjAsXG4gICAgICAgICAgICAgICAgc3R5bGU6IFwiYmxhY2tcIixcbiAgICAgICAgICAgICAgICBkZW5zaXR5OiAxMjAwLjAsXG4gICAgICAgICAgICAgICAgZnJpY3Rpb246IDAuOSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfSxcbiAgICB0ZXJyYWluOiB7XG4gICAgICAgIGhtYXA6IFtcbiAgICAgICAgICAgIDQwLjAsXG4gICAgICAgICAgICA0MC4wLFxuICAgICAgICAgICAgNDAuMCxcbiAgICAgICAgICAgIDQwLjAsXG4gICAgICAgICAgICA0MC4wLFxuICAgICAgICAgICAgNDAuMCxcbiAgICAgICAgICAgIDQwLjAsXG4gICAgICAgICAgICAyMC4wLFxuICAgICAgICAgICAgMjAuMCxcbiAgICAgICAgICAgIDIwLjAsXG4gICAgICAgICAgICAyMC4wLFxuICAgICAgICAgICAgMjAuMCxcbiAgICAgICAgICAgIDIwLjAsXG4gICAgICAgICAgICAyMC4wLFxuICAgICAgICAgICAgNDAuMCxcbiAgICAgICAgICAgIDQwLjAsXG4gICAgICAgICAgICA0MC4wLFxuICAgICAgICAgICAgNDAuMCxcbiAgICAgICAgICAgIDQwLjAsXG4gICAgICAgICAgICA0MC4wLFxuICAgICAgICAgICAgNDAuMCxcbiAgICAgICAgXSxcbiAgICAgICAgc3R5bGU6IFwiZGFya2dyZXlcIixcbiAgICAgICAgcGl0Y2g6IDUuMCxcbiAgICAgICAgZnJpY3Rpb246IDAuNSxcbiAgICB9LFxuICAgIGhlaWdodDogMTAwLjAsXG4gICAgZzogWzAuMCwgLTkuOF0sXG59O1xuXG5jb25zdCBvZGUgPSBzY2VuZU1ldGhvZChzY2VuZSk7XG5jb25zdCByZW5kZXIgPSBzY2VuZVJlbmRlcmVyKHNjZW5lKTtcblxuY29uc3QgdnAgPSBuZXcgVmlld3BvcnQoY3R4LCAoX2IsIF9zLCBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCkgPT4ge1xuICAgIHJlbmRlcihjdHgsIG9kZSk7XG59KTtcblxuZnVuY3Rpb24gY2xpcCh2OiBudW1iZXIsIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIE1hdGgubWluKG1heCwgTWF0aC5tYXgobWluLCB2KSk7XG59XG5cbnZwLnNldENsaXBQb3NpdGlvbigocDogVmlld3BvcnRQb3NpdGlvbik6IFZpZXdwb3J0UG9zaXRpb24gPT4ge1xuICAgIHAuc2NhbGUgPSBjbGlwKHAuc2NhbGUsIDEwLjAsIDEwMDAuMCk7XG4gICAgcC5wb3NbMF0gPSBjbGlwKHAucG9zWzBdLCAwLCBzY2VuZS50ZXJyYWluLnBpdGNoICogKHNjZW5lLnRlcnJhaW4uaG1hcC5sZW5ndGggLSAxKSk7XG4gICAgcC5wb3NbMV0gPSBjbGlwKHAucG9zWzFdLCAwLCBzY2VuZS5oZWlnaHQpO1xuICAgIHAucm90YXRlID0gMC4wO1xuICAgIHJldHVybiBwO1xufSk7XG5cbnZwLnNldFBvc2l0aW9uKHsgcG9zOiBbNTAsIDUwXX0pO1xuXG5jb25zdCBoID0gMC4wMDE7XG5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKHQwOiBET01IaWdoUmVzVGltZVN0YW1wKSA9PiB7XG4gICAgZnVuY3Rpb24gbWFpbkxvb3AodDogRE9NSGlnaFJlc1RpbWVTdGFtcCkge1xuICAgICAgICAvLyBDb21wdXRlIHVwIHRvIDI1MG1zIHdvcnRoIG9mIGZyYW1lcyBhdCBhIHRpbWUuXG4gICAgICAgIGNvbnN0IGR0ID0gTWF0aC5taW4odCAtIHQwLCAyNTAuMCk7XG4gICAgICAgIGNvbnN0IGZyYW1lcyA9IE1hdGguZmxvb3IoZHQgLyAoMTAwMC4wICogaCkpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZyYW1lczsgaSsrKSB7XG4gICAgICAgICAgICBvZGUubmV4dChoKTtcbiAgICAgICAgfVxuICAgICAgICB2cC5yZXF1ZXN0UmVkcmF3KCk7XG4gICAgICAgIC8vIE9ubHkgbGV0IHRoZSBwaHlzaWNzIGJhY2tsb2cgZ2V0IHRvIDI1MG1zLlxuICAgICAgICB0MCA9IE1hdGgubWF4KHQwICsgZnJhbWVzICogaCAqIDEwMDAuMCwgdCAtIDI1MC4wKTtcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKG1haW5Mb29wKTtcbiAgICB9XG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKG1haW5Mb29wKTtcbn0pO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB2cC5yZXNpemUpO1xuXG5jb25zdCB0b3VjaCA9IG5ldyBUb3VjaERlbXV4KGMpO1xuY29uc3QgZ2VzdHVyZSA9IG5ldyBHZXN0dXJlcygpO1xudG91Y2guYWRkVG91Y2hIYW5kbGVyKGdlc3R1cmUpO1xuZ2VzdHVyZS5hZGRHZXN0dXJlSGFuZGxlcihuZXcgUGFuR2VzdHVyZSh2cCkpO1xuZ2VzdHVyZS5hZGRHZXN0dXJlSGFuZGxlcihuZXcgUGluY2hab29tR2VzdHVyZSh2cCkpO1xuXG4vLyBUT0RPOiBtb3VzZSBhbmQgdHJhY2twYWQgaW5wdXRcbi8vIHNjcm9sbFxuLy8gc2Nyb2xsIHdoZWVsIHpvb20gaW4gYW5kIG91dFxuLy8gd2hhdCB0byByb3RhdGU/IHJpZ2h0IGNsaWNrIGRyYWcsIHJvdGF0ZSBhcm91bmQgY2VudGVyIG9mIHZwPyBNYXliZSBkb24ndCBjYXJlLCBzaW5jZSBicmlkZ2Ugd29udCB1c2Ugcm90YXRlXG5cbi8vIFRPRE86IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9FbGVtZW50L3JlcXVlc3RGdWxsc2NyZWVuXG4vLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRnVsbHNjcmVlbl9BUEkvR3VpZGVcbi8vIExvb2sgaW50byB0aGlzXG5cbi8vIFRPRE86IHJld3JpdGUgdmlld3BvcnQgZXRjLiB0byBub3QgdGFrZSBjYWxsYmFja3MsIGp1c3QgY2FsbCBpbnRvIGl0IHRvIGV4cGxjaXRseSBzZXQgdXAgY2FudmFzLCBldGMuXG5cbi8vIFRPRE86IFBoeXNpY3MgY2FsY3VsYXRpb24gaW4gYSB3ZWItd29ya2VyLlxuXG4vLyBUT0RPOiBBaXIgcmVzaXN0YW5jZSwgb3IgYXQgbGVhc3QgZGFtcGluZyBvZiBwaW4gbW92ZW1lbnQsIG5vdCBqdXN0IGJlYW0gc3ByaW5nIGZvcmNlcy4gS2VlcCBiZWFtIGRhbXBpbmcsIHRoaXMgc2hvdWxkIGJlIGluZGVwZW5kZW50LlxuXG4vLyBUT0RPOiBCZWFtcyBmYWlsIGFmdGVyIHNvbWUgc3RyZXNzLlxuXG4vLyBUT0RPOiBXb3JrIGhhcmRlbmluZy5cblxuLy8gVE9ETzogQmVhbSBidWNrbGluZy5cblxuXG5jb25zb2xlLmxvZyhcInN0dWZmIGxvYWRlZFwiKTtcbiJdfQ==